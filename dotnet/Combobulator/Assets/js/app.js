/*! by John Przeslakowski - visit me at http://goodpixels.co.uk */
function sysMsg(a){$sys.attr("data-system-message",a)}function Logic(){var a,b,c=this,d=["lifestyle","economy","speed","price","convertible","high","awd","luggage","capacity"],e=[];this.optimizeData=function(){return $(b).each(function(a,c){b[a].awd=parseInt(c.awd),b[a].high=parseInt(c.high),b[a].convertible=parseInt(c.convertible),b[a].price=parseInt(c.price),b[a].cost=parseInt(c.cost),b[a].speed=parseInt(c.speed),b[a].mph=parseInt(c.mph),b[a].economy=parseInt(c.economy),b[a].mpg=parseFloat(c.mpg)}),b},this.getAddresses=function(a){return $.when($.ajax({url:path.apiPostcode,data:{postcode:a},error:function(){tpl=!1}})).then(function(a){return a})},this.getDealers=function(a){return $.when($.ajax({url:path.apiDealers,data:{postcode:a},error:function(){tpl=!1}})).then(function(a){return a})},this.getFinance=function(a){var b=this.getCarByCode(a),c=b.finance;return c.total_deposit=c.deposit+c.contribution,c.total_amount=c.price+c.credit_charge,c.terms=b.terms,c},this.eggs=function(a){var b=["Alien","Dog","Cat"],c=a.seats[4],d=[],e=$.inArray(c,b);return e>=0&&d.push(b[e].toLowerCase()),5===a.speed&&d.push("rocket"),priceChanged&&a.price<=190&&d.push("toy"),d.length<=0&&(d=!1),d},this.getCars=function(b){if("object"==typeof b.eggs)return{data:"easter egg"};var f=a(b.prepared).get();if(f.length>0){e=[];var g={queryPrepared:b.prepared,queryRaw:b.raw,data:f};return g}e.push(d[e.length]);var h=new c.query;return this.getCars(h.build(h.filter(b.raw,e)))},this.getCarByName=function(b){return a({name:b}).first()},this.getCarByCode=function(b){return a({code:b}).first()},this.query=function(){this.filter=function(a,b){var b=b||[];a.capacity||delete a.capacity,a.luggage||delete a.luggage,a.lifestyle||delete a.lifestyle,a.awd||delete a.awd,a.high||delete a.high,a.convertible||delete a.convertible,a.price||delete a.price,a.speed||delete a.speed,a.economy||delete a.economy;for(var c=0;c<b.length;c++)delete a[b[c]];return a},this.build=function(a){var b,c={},d=a;return d.capacity&&(c.capacity={likenocase:d.capacity}),d.luggage&&(c.luggage={likenocase:d.luggage}),d.lifestyle&&(c.lifestyle={likenocase:d.lifestyle}),d.awd&&(c.awd=d.awd),d.high&&(c.high=d.high),d.convertible&&(c.convertible=d.convertible),d.price&&(c.price={lt:d.price+1}),d.speed&&(c.speed={gt:d.speed-1}),d.economy&&(c.economy={gt:d.economy-1}),b={prepared:c,raw:a}},this.convert=function(a){function b(a){return 25>a?0:a>=25&&46>a?1:a>=46&&61>a?2:a>=61&&70>a?3:a>=70?4:void 0}function c(a){return 191>a?0:a>=191&&216>a?1:a>=216&&246>a?2:a>=246&&270>a?3:a>=270&&295>a?4:a>=295?5:void 0}function d(a){return"minimalist"===a?1:"light-packer"===a?2:"lugger"===a?3:"big-loader"===a?4:void 0}function e(a){var b={people:0,children:0,infants:0};if(a=_.compact(a),a.length<1)return 0;for(var c=0;c<a.length;c++){var d=a[c];("Man"===d||"Woman"===d)&&b.people++,("Girl"===d||"Boy"===d)&&b.children++,"Infant"===d&&b.infants++}return b.family=b.people+b.children,b.family<=2&&0===b.infants?1:b.family<=4&&0===b.infants?2:b.family<=3&&1===b.infants?2:2===b.people&&b.children>0&&b.children<=2&&0===b.infants?3:1===b.people&&b.children>0&&b.children<=3&&0===b.infants?3:5===b.family?4:4===b.family&&1===b.infants?4:3===b.family&&2===b.infants?4:b.family<=3&&b.family>0&&b.infants>0&&b.infants<=2?4:void 0}return obj={capacity:_.compact(a.seats).length>0?e(a.seats).toString():!1,luggage:d(a.luggage).toString(),lifestyle:parseInt(a.lifestyle).toString(),price:c(a.price),speed:"lightspeed"===a.speed?a.speed:parseInt(a.speed),economy:b(a.mpg),awd:a.options.awd||!1,high:a.options.hp||!1,convertible:a.options.dt||!1},obj}};var f=function(d){return b=d,a=TAFFY(JSON.stringify(b)),c.database=a,$.publish("data-loaded"),a},g=function(){var a=store.get("miniData")||!1;a?f(a):$.ajax({url:path.api,error:function(){alert("There's been a problem obtaining the results.")},success:function(a){a.Error?alert(a.Error):(f(a),store.set("miniData",a))}})};g()}function Dials(){this.roller=function(a){var b=$(a).siblings(".list"),c=b.find(".item:nth-child( 2 )").height(),d=c*(b.find(".item").length-1),e=function(){var a=this;TweenLite.to(this.$slot.get(0),.6,{y:0,onComplete:function(){a.update()}}),this.$list.find(".item").removeClass("active"),this.$list.removeClass("dragging").removeAttr("style"),this.update()},f=function(){var a=g(this.y,c,0),d=b.find(".item").eq(a),e=d.data("value")||d.text();return"Empty"===e?0:e},g=function(a,b){var c=Math.abs(a),d=Math.ceil(c/b);return Math.ceil(d)+1};$(a).height(d);var h=new Draggable(a,{type:"y",bounds:$(a).parent(),edgeResistance:1,throwProps:!0,onDrag:function(){{var a=g(this.y+40,c,0);b.find(".item").removeClass("active").eq(a).addClass("active")}b.addClass("dragging").css({transform:"translate3d( 0px, "+this.y+"px, 0px )"})},onDragEnd:function(){b.removeClass("dragging").css({transform:"translate3d( 0px, "+this.endY+"px, 0px )"})},snap:function(a){return Math.round(a/c)*c}});return h.getValue=f,h.reset=e,h.$list=b,h.$slot=$(a),h},this.luggage=function(){var a=0,b=document.querySelector(".control.luggage .dial"),c=90,d=function(){return $(b).attr("class").replace("dial","").trim()},e=function(){$(".control.luggage .arrows").on("mousedown mouseup touchstart touchend",function(a){a.preventDefault(),"mousedown"===a.type?$(this).removeClass("right left").addClass(a.target.id):$(this).removeClass("right left")}),$("#left, #right").on("click",function(d){d.preventDefault(),$(b).removeClassExcept("dial");var e=($(".control.luggage .dial"),d.target.id),h="left"===e?a+c:a-c;TweenLite.to(b,1,{rotation:h,onComplete:function(){f(h)}}),g.update(),a=h})},f=function(a){var d=a/c%c%4;(-1===d||3===d)&&(final_class="light-packer"),(-2===d||2===d)&&(final_class="lugger"),(-3===d||1===d)&&(final_class="big-loader"),0===d&&(final_class="minimalist"),$(b).removeClassExcept("dial").addClass(final_class)},g=new Draggable(b,{type:"rotation",throwProps:!0,onThrowComplete:function(){f(parseInt(this.endRotation))},onDragStart:function(){$(b).removeClassExcept("dial")},onDragEnd:function(){a=parseInt(this.endRotation)},snap:function(a){return Math.round(a/c)*c}});return e(),g.getLuggage=d,g},this.options=function(){this.getOptions=function(){var a=$(".control.options input"),b={};return a.each(function(){b[$(this).attr("id")]=$(this).hasClass("checked")}),b},$(".option").on("click",function(a){a.preventDefault();var b=$(this).find("input");b.toggleClass("checked")})},this.lifestyle=function(){var a,b=function(){return $("#c-lifestyle .slick-slide.slick-active").attr("data-value")},c=document.querySelector(".control.lifestyle .dial"),d=5,d=45;if(!ie.loadFallbacks())var e=$(".items-wrapper").slick({arrows:!1,infinite:!0,slide:".item",onAfterChange:function(){f.enable()}});var f=new Draggable(c,{type:"rotation",bounds:{minRotation:-d,maxRotation:d},throwProps:!0,snap:function(){return!0},onDragStart:function(){a=Math.abs(this.y)},onDragEnd:function(){var b=Math.abs(this.y)>a?"right":"left";ie.loadFallbacks()?"right"===b?ie.lifestyle.prev():ie.lifestyle.next():e.slick("right"===b?"slickPrev":"slickNext")}});return f.getLifestyle=b,f},this.mpg=function(){var a=document.querySelector(".control.mpg .arrow"),b=120,c=13,d=25,e=80,f=function(){return g._value},g=new Draggable(a,{type:"rotation",bounds:{minRotation:-b,maxRotation:b},onDrag:function(){var a=(this.rotation+b)/(2*b),f=parseInt((a+1/(2*c))*c),g=e-d,h=parseInt(d+a*g);this._value=h,$(".control.mpg").removeClassExcept("control mpg").addClass("control mpg scale-"+f),$("#mpg_value").text(h)}});return TweenLite.set(a,{rotation:-b}),g.update(),g._value=d,$("#mpg_value").text(g._value),g.getMpg=f,g},this.price=function(){var a=function(){var a=b(c)||0,d=190,e=300,f=e-d;return parseInt(f/100*a)+d},b=function(a){var b=Math.abs(parseInt(a.endY)),c=Math.abs(b/a.minY*100);return c},c=new Draggable(".control.price .handle",{type:"y",edgeResistance:1,bounds:".control.price .bounds",throwProps:!1,onDragStart:function(){priceChanged=!0},onDrag:function(){$(".control.price .switch-bg").css("height",b(this)+"%")}});return c.getPrice=a,c}}function Dashboard(){var a,b,c,d,e,f,g;this.colors=function(a){$(".switch-bg").css({"background-color":a,"border-color":a}),$(".switch-fill path").css({fill:a}),$(".switch-light").css({"-webkit-box-shadow":"0 0 5px "+a+", 0 0 15px "+a,"-moz-box-shadow":"0 0 5px "+a+", 0 0 15px "+a,"-box-shadow":"0 0 5px "+a+", 0 0 15px "+a,"background-color":a}),$(".switch-color").css("color",a)},this.seats=function(){var b=new a.roller("#c-bums #roller1 .fake-list"),c=new a.roller("#c-bums #roller2 .fake-list"),d=new a.roller("#c-bums #roller3 .fake-list"),e=new a.roller("#c-bums #roller4 .fake-list"),f=new a.roller("#c-bums #roller5 .fake-list"),g=function(){var a=[];return a.push(b.getValue()),a.push(c.getValue()),a.push(d.getValue()),a.push(e.getValue()),a.push(f.getValue()),a};return $("#reset").on("click",function(a){a.preventDefault(),b.reset(),c.reset(),d.reset(),e.reset(),f.reset()}),g()},this.values=function(){var a=ie.loadFallbacks()?ie.rollers.getSeats():this.seats(),h=ie.loadFallbacks()?ie.rollers.getSpeed():g.getValue(),i=ie.loadFallbacks()?ie.lifestyle.get():f.getLifestyle(),j={seats:a,lifestyle:i,speed:h,mpg:c.getMpg(),luggage:d.getLuggage(),options:e.getOptions(),price:b.getPrice()};return j},this.init=function(){a=new Dials,b=new a.price,c=new a.mpg,d=new a.luggage,e=new a.options,f=new a.lifestyle,ie.loadFallbacks()?(ie.rollers.init(),ie.speed.init(),ie.lifestyle.init()):(g=new a.roller("#c-speed .control.speed .fake-list"),this.seats())}}function UI(){this.$panel=$body.find(".panel-results"),this.getTpl=function(a){var b=new $.Deferred,c=store.get("miniTemplates")||{};return c.hasOwnProperty(a)?b.resolve(c[a]):b=$.get(path.templates+"/"+a+".mustache").then(function(b){var c=store.get("miniTemplates")||{},d={};return d[a]=b,c.hasOwnProperty(a)||store.set("miniTemplates",_.extend(c,d)),b}),b},this.renderTpl=function(a,b){return Mustache.render(a,b)};var a=function(a,b){var c=$body.find("#uid").val();return"undefined"==typeof c?a+"m="+b:a+"m="+b+"&c="+c};this.loadSVGs=function(){var a=document.querySelectorAll(".svg");SVGInjector(a,{pngFallback:path.spriteFallback,each:function(a){$(a).hide().fadeIn(600)}})},this.showPanel=function(a){$body.find("[data-panel-name]").removeClass("panel-active"),$body.find('[data-panel-name="'+a+'"]').addClass("panel-active")},this.preloadImages=function(){this.loadSVGs(),sysMsg("Loading: 0%"),$.get(path.preload,{type:"svg"},function(a){var b=0;$.map(a,function(c){$.get(c,function(){var d=new Image;d.src=c,$(d).on("load",function(){b++;var c=(a.length/100,b/a.length*100),d=0;d=Math.floor(c),sysMsg("Loading: "+d+"%"),100===d&&$sys.toggleClass("hidden")})})})})},this.render=function(b,c){var d=this,c=c||!1,e=function(a,b){var c=d.$panel.find(".car-changer"),b=b||!1,e=logic.getCarByName(a.alt_1),f=logic.getCarByName(a.alt_2),g=logic.getCarByName(a.alt_3);if(e===!1||f===!1||g===!1){alert("John Cooper Works is missing - please update the dataset with that car.");{_.isObject(e)?"":" - NO MATCH FOUND IN "+path.api,_.isObject(f)?"":" - NO MATCH FOUND IN "+path.api,_.isObject(g)?"":" - NO MATCH FOUND IN "+path.api}}else b||(c.removeClass("active").filter(":first").addClass("active"),c.eq(0).attr("href","#"+a.code).find("img").attr("src",path.assets+a.code+".png"),c.eq(1).attr("href","#"+e.code).find("img").attr("src",path.assets+e.code+".png"),c.eq(2).attr("href","#"+f.code).find("img").attr("src",path.assets+f.code+".png"),c.eq(3).attr("href","#"+g.code).find("img").attr("src",path.assets+g.code+".png"))};Mini.browser.mobile&&setTimeout(function(){$(".layout > .column.left").removeClass("open")},0),b.url=a(path.results,b.code),b.img=path.assets+b.code+".png",this.getTpl("results").then(function(a){$("#tpl-results").contents().remove(),$("#tpl-results").append(d.renderTpl(a,b))}),e(b,c),dashboard.colors(carColors[b.color]),this.showPanel("results"),Mini.browser.mobile&&$([$html[0],$body[0]]).animate({scrollTop:0},600)},this.eggs=function(a){var b={rocket:{code:"RKT",color:"Rocket gold",name:"Rocket Car!",cost:"n/a",terms:"A ro-ro-ro-rocket car!"},toy:{code:"TOY",color:"Toy brown",name:"Toy Car",cost:"n/a",terms:"Just a silly toy..."}};switch($html.removeClassBeginningWith("egg").addClass("egg-"+a),a){case"toy":this.render(b.toy);break;case"rocket":this.render(b.rocket);break;case"creature":alert("These search results will show one of the creatures.")}}}function sharing(){$body.on("click",".js-sharer li a",function(a){a.preventDefault();{var b=($(this),$(this).parent());b.attr("title"),location.href}switch($(b).attr("class")){case"facebook":"direct"===$(b).data("fb-mode")?FB.login(function(a){a.authResponse?FB.api("/me/feed","POST",social.facebook,function(a){alert(a.error?a.error.error_user_msg:"Thanks! Posting completed.")}):alert("We couldn't authorise you. Sorry for the inconvenience.")},{scope:"publish_actions",return_scopes:!0}):FB.ui({method:"share",href:social.facebook.link},function(a){alert(a&&!a.error_code?"Thanks! Posting completed.":"We couldn't post to your wall.")});break;case"twitter":var c=void 0!==social.twitter.hashtags?social.twitter.hashtags:"",d="https://twitter.com/intent/tweet?hashtags="+c+"&text="+social.twitter.text+"&url="+social.twitter.url;window.open(d,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")}})}function Responsive(){var a=matchMedia("( max-width: 767px ) and ( orientation: landscape )"),b=matchMedia("( max-width: 767px )"),c=matchMedia("( min-width: 768px ) and ( max-width: 1179px )"),d=matchMedia("( min-width: 1180px )"),e=function(a){this.on=function(){$html.addClass("page-disabled")},this.off=function(){$html.removeClass("page-disabled")},a.matches?this.on():this.off()},f=function(a){this.on=function(){$(".control-title").off("click").on("click",function(a){a.preventDefault(),$(this).toggleClass("open");var b=$(this).find(".light"),c=$(".car-changer").css("border-color");$(this).hasClass("open")?(b.addClass("switch-light"),$.publish("colour-change",c)):(b.removeClass("switch-light"),b.removeAttr("style"))})},this.off=function(){$(".control-title").removeClass("open").off(),$(".control-title .light").removeAttr("style").removeClass("switch-light")},a.matches?this.on():this.off()},g=function(a){this.on=function(){$("#tablet-toggle").off("click").on("click",function(a){a.preventDefault(),$(".layout > .column.left").toggleClass("open")}),$("#page-home .layout, #dash").height($(window).innerHeight()-($(".layout-header").height()+4))},this.off=function(){$("#tablet-toggle").off(),$(".layout > .column.left").removeClass("open"),$("#page-home .layout, #dash").removeAttr("style")},a.matches?this.on():this.off()},h=function(a){this.on=function(){},this.off=function(){},a.matches?this.on():this.off()},i=function(){var i=function(){a.matches&&e(a),b.matches&&f(b),c.matches&&g(c),d.matches&&h(d)};a.addListener(e),b.addListener(f),c.addListener(g),d.addListener(h),$(window).on("load orientationchange",i)};i()}function IE(){var a=["#c-bums #roller1","#c-bums #roller2","#c-bums #roller3","#c-bums #roller4","#c-bums #roller5","#c-speed .control.speed"],b={loadFallbacks:function(){return Mini.browser.isIE("<=8")&&Mini.browser.isIE()},polyfills:function(){$("#dash").addClass("ie-fallbacks"),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")})},flow:function(){document.querySelector("html").className+=" oldie ie"+parseInt(Mini.browser.version),$(".select > select, .checkbox > input").unwrap(),ui.loadSVGs(),$sys.remove(),$(".control.start .shape").on("click",function(){$("#start").trigger("click")})},rollers:{getSeats:function(){var b=[];return $(_.initial(a)).each(function(a,c){var d=$(c).find(".active").data("value")||$(c).find(".active").text(),e="Empty"===d?0:d;b.push(e)}),b},getSpeed:function(){return $(_.last(a)).find(".active").data("value")},init:function(){$("#reset").remove(),$(a).each(function(a,b){var c=$(b),d=c.find(".list");c.find(".fake-list, .item-extra, .bumper").remove(),d.addClass("list-static").removeClass("list"),c.find(".item:first").addClass("active"),d.on("click",function(){$(".list-static").not(this).removeClass("open"),$(this).toggleClass("open")}),d.find(".item").on("click",function(a){a.preventDefault(),$(this).addClass("active").siblings().removeClass("active")})})}},speed:{init:function(){}},lifestyle:{w:$("#c-lifestyle .window .items-wrapper"),init:function(){this.w.addClass("ie-friendly")},get:function(){var a=$(".items-wrapper .item:first").attr("class").replace("item ","");return a},next:function(){var a=this.w.find(".item"),b=a.filter(":first"),c=a.filter(":last");b.insertAfter(c)},prev:function(){var a=this.w.find(".item"),b=a.filter(":first"),c=a.filter(":last");c.insertBefore(b)}}};return b.loadFallbacks()&&(b.polyfills(),$(document).on("ready",function(){b.flow()})),b}var social={facebook:{link:"http://google.com",message:"This is the message which will be posted to the user's wall.",name:"Image name",caption:"Image caption",picture:"http://placehold.it/200x200",description:"Just a test description."},twitter:{url:"http://google.com",text:"This is the message which will be posted to the user's wall.",hashtags:"mini,cooper"}},system_paths={net:{assets:"Assets/cars/",results:"results?",spriteFallback:"Assets/sprites",api:"api/car",apiPostcode:"api/postcodelookup",apiPostcode:"api/dealerlookup",preload:"api/assets/svg",templates:"Assets/js/tpl"},php:{assets:"assets/cars/",results:"results.php?",spriteFallback:"assets/sprites",api:"json/data.json",apiPostcode:"postcode.php",apiDealers:"dealers.php",preload:"preload.php",templates:"assets/js/tpl"}},path=location.href.indexOf("mini.fs")>=0?system_paths.php:system_paths.net,carColors={"Volcanic Orange":"#f7941d","Electric Blue":"#30b6e8","Lightning Blue":"#1164ac","Jungle Green":"#426046","Chili red":"#d71d24","Blazing Red":"#c10000","Pepper white":"#e4dfce","Light white":"#e4dfce","Toy brown":"#47322e","Rocket gold":"gold"},$html=$("html"),$body=$("body"),$sys=$("#system"),w=window,Mini={settings:{debug:!0},thirdParty:{facebookID:892580704115737,analyticsID:"UA-000000-01"},browser:{name:$.browser.name,version:$.browser.version,mobile:$.browser.mobile||!1,platform:$.browser.platform,isIE:function(version){switch(typeof version){case"string":return"msie"===$.browser.name&&"win"===$.browser.platform&&eval(parseInt($.browser.version)+version);case"number":return"msie"===$.browser.name&&"win"===$.browser.platform&&parseInt($.browser.version)===version;default:return"msie"===$.browser.name&&"win"===$.browser.platform}}}};if(document.querySelector("html").className+=" "+Mini.browser.platform,Mini.browser.isIE()||(document.querySelector("html").className+=" "+Mini.browser.name,$html.removeClass("ie")),"undefined"==typeof Modernizr){var bodyClass=document.querySelector("html").className;document.querySelector("html").className=bodyClass.replace("no-js","js")}$.validator.setDefaults({rules:{name:{required:!0},surname:{required:!0},"address-1":{required:!0},"address-2":{required:!0},"address-3":{required:!0},"address-4":{required:!0},"tel-home":{required:!0},"tel-work":{required:!0},"tel-mobile":{required:!0},dealer:{required:!0},title:{required:!0},postcode:{required:!0},email:{required:!0,email:!0}},messages:{name:{required:"First name is required."},surname:{required:"Last name is required."},"address-1":{required:"Address line 1 is required."},"address-2":{required:"Address line 2 is required."},"address-3":{required:"Address line 3 is required."},"address-4":{required:"Address line 4 is required."},"tel-home":{required:"Home telephone is required."},"tel-work":{required:"Work telephone is required."},"tel-mobile":{required:"Mobile telephone is required."},dealer:{required:"Please choose a dealer from the list."},title:{required:"Title is required."},postcode:{required:"Postcode is required."},email:{required:"E-mail is required.",email:"Please enter a valid e-mail address."}}}),$.validator.setDefaults({showErrors:function(a,b){b.length>0&&$(b).each(function(a,b){var b=b.element,c=b.tagName.toLowerCase();"select"===c?$(b).parent().addClass("error"):$(b).addClass("error")})},submitHandler:function(a){var b=$(a).attr("action"),c=1e3,d=function(){$.ajax({type:"POST",url:b,data:{form:$("form").serializeObject(),car:carCode,input:store.get("miniInput"),localDealer:dealersObj[$("#dealers").val()]},dataType:"json",complete:function(){$(a).toggleClass("busy")},success:function(a){$.publish("form-ajax-results",a)},error:function(a){alert("Couldn't submit the form with AJAX, returning XHR object to the console:")},beforeSend:function(){Mini.settings.debug}})};$(a).toggleClass("busy"),setTimeout(function(){d()},c)},ignore:!1,onkeyup:function(a){$(a).removeClass("error"),$(a).parent().removeClass("error"),$(a).closest(".form-control").find(".form-error").remove()},onfocusout:function(a){$(a).removeClass("error"),$(a).parent().removeClass("error"),$(a).closest(".form-control").find(".form-error").remove()}}),"addEventListener"in document&&document.addEventListener("DOMContentLoaded",function(){FastClick.attach(document.body)},!1);var priceChanged=!1,ie=new IE,ui=new UI,logic=new Logic,query=new logic.query,carCode=getQueryParameter("m")||!1,addressObj,dealersObj,responsive,dashboard,postcodeTimer,form={addresses:"#addresses",address1:"#address-1",address2:"#address-2",address3:"#address-3",addressChooser:"#address-chooser",dealerChooser:"#dealer-chooser",dealers:"#dealers"};(Mini.browser.isIE(">8")||!Mini.browser.isIE())&&(ui.preloadImages(),responsive=new Responsive),dashboard=new Dashboard,$(window).load(function(){var a=carCode?logic.getCarByCode(carCode).color:!1,b=a?a:"Electric Blue";dashboard.colors(carColors[b]),$("#dash").length&&dashboard.init(),$.subscribe("colour-change",function(a,b){dashboard.colors(b)}),ui.showPanel("default"),$("form").validate(),$.subscribe("form-ajax-results",function(a,b){b.success&&ui.showPanel("thanks")}),sharing(),$("#terms-link").on("click",function(a){a.preventDefault();var b=$(this).attr("href"),c=$(b).find(".close");$("html").removeClass("terms-visible").addClass("terms-visible"),c.on("click",function(a){a.preventDefault(),$("html").removeClass("terms-visible")})}),$("#tpl-finance").length>0&&ui.getTpl("finance").then(function(a){$("#tpl-finance").replaceWith(ui.renderTpl(a,logic.getFinance(carCode)))}),$("#start").on("click",function(a){a.preventDefault();var b=dashboard.values();store.set("miniInput",b),$html.removeClassBeginningWith("egg");var c=logic.eggs(b);if($.inArray("toy",c)>=0||$.inArray("rocket",c)>=0)return void($.inArray("rocket",c)>=0&&$.inArray("toy",c)>=0?ui.eggs("rocket",c):$.inArray("toy",c)>=0?ui.eggs("toy",c):ui.eggs("rocket",c));var d=query.build(query.convert(dashboard.values())),e=logic.getCars(d),f=e.data;if(f.length>0){var g=f[_.random(f.length-1)];$.inArray("dog",c)>=0||$.inArray("cat",c)>=0||$.inArray("alien",c)>=0?(ui.eggs("creature",c),ui.render(g)):ui.render(g)}}),$body.on("click",".car-changer",function(a){a.preventDefault();var b=$(this).attr("href"),c=logic.getCarByCode(b.substring(1));$(".car-changer").removeClass("active").filter(this).addClass("active"),ui.render(c,!0)})});var formatAddress=function(a,b){for(var b=b||[],c=new String,d=0;d<b.length;d++){var e=b[d];delete a[e]}for(var e in a)_.isEmpty(a[e])||(c+=a[e]+", ");return c=c.substr(0,c.length-2)},handlePostcode=function(){var a=$("#postcode").val();$(".disabled").removeClass("disabled").find("[disabled]").prop("disabled",!1),logic.getAddresses(a).then(function(a){addressObj=a,formattedAddresses=[],$(form.addressChooser).contents().remove(),$(a).each(function(a,b){var c=new String;for(var d in b)_.isEmpty(b[d])||(c+=b[d]+", ");c=c.substr(0,c.length-2),formattedAddresses.push({id:a,address:c})}),ui.getTpl("addresses").then(function(a){$(form.addressChooser).append(ui.renderTpl(a,{addresses:formattedAddresses})),$(form.addresses).rules("add",{required:!0,messages:{required:"Please select your address from the list."}})})}),logic.getDealers(a).then(function(a){dealersObj=a,formattedDealers=[],$(form.dealerChooser).contents().remove(),$(a).each(function(a,b){var c=formatAddress(b);formattedDealers.push({id:a,dealer:c})}),ui.getTpl("dealers").then(function(a){$(form.dealerChooser).append(ui.renderTpl(a,{dealers:formattedDealers})),$(form.dealers).rules("add",{required:!0,messages:{required:"Please select your nearest dealer."}})})})};$("#postcode").on("keyup",function(a){a.which<=90&&a.which>=48&&(clearTimeout(postcodeTimer),postcodeTimer=setTimeout(handlePostcode,600))}),$body.on("change",form.addresses,function(){var a=addressObj[$(this).val()];_.isEmpty($(this).val())?($(form.address1).val(null),$(form.address2).val(null),$(form.address3).val(null)):($(form.address1).val(formatAddress(_.extend({},a),["County","Town","Postcode"])),$(form.address2).val(a.Town),$(form.address3).val(a.County))}),$.subscribe("form-ajax-results",function(a,b){alert("Thanks! Data has been logged to the console.")});